<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Lovem & ndash; the low overhead virtual embedded machine. And the journey getting there."><meta name=author content=kratenko><link rel=canonical href=https://kratenko.github.io/lovem/2022-08/you-labeled-me-i-ll-label-you.html><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-8.5.10"><title>You labeled me, I'll label you - Lovem</title><link rel=stylesheet href=../assets/stylesheets/main.975780f9.min.css><link rel=stylesheet href=../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../stylesheets/custom.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=None data-md-color-accent=None> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#you-labeled-me-ill-label-you class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../index.html title=Lovem class="md-header__button md-logo" aria-label=Lovem data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Lovem </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> You labeled me, I'll label you </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/kratenko/lovem title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> kratenko/lovem </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../index.html title=Lovem class="md-nav__button md-logo" aria-label=Lovem data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> Lovem </label> <div class=md-nav__source> <a href=https://github.com/kratenko/lovem title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> kratenko/lovem </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../index.html class=md-nav__link> The Journey </a> </li> <li class=md-nav__item> <a href=../source-code.html class=md-nav__link> Source Code </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <div class="md-nav__link md-nav__link--index "> <a href=../journal/index.html>Journal</a> <label for=__nav_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=Journal data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Journal </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_3_2 type=checkbox id=__nav_3_2 checked> <div class="md-nav__link md-nav__link--index "> <a href=../2024-02/index.html>February 2024</a> <label for=__nav_3_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="February 2024" data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> February 2024 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../2024-02/we-have-variables.html class=md-nav__link> We have variables! </a> </li> <li class=md-nav__item> <a href=../2024-02/stop-right-there-that-s-far-enough.html class=md-nav__link> Stop right there, that's far enough! </a> </li> <li class=md-nav__item> <a href=../2024-02/it-has-been-a-while.html class=md-nav__link> It has been a while... </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 type=checkbox id=__nav_3_3 checked> <div class="md-nav__link md-nav__link--index "> <a href=index.html>August 2022</a> <label for=__nav_3_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="August 2022" data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> August 2022 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=what-if.html class=md-nav__link> What if? </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> You labeled me, I'll label you <span class="md-nav__icon md-icon"></span> </label> <a href=you-labeled-me-i-ll-label-you.html class="md-nav__link md-nav__link--active"> You labeled me, I'll label you </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#labels class=md-nav__link> Labels </a> </li> <li class=md-nav__item> <a href=#reconstruction class=md-nav__link> Reconstruction </a> </li> <li class=md-nav__item> <a href=#parsing-label-definitions class=md-nav__link> Parsing label definitions </a> </li> <li class=md-nav__item> <a href=#lifetime class=md-nav__link> Lifetime </a> <nav class=md-nav aria-label=Lifetime> <ul class=md-nav__list> <li class=md-nav__item> <a href=#an-example class=md-nav__link> An example </a> </li> <li class=md-nav__item> <a href=#easy-way-out class=md-nav__link> Easy way out </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#run-it-already class=md-nav__link> Run it already! </a> </li> <li class=md-nav__item> <a href=#homework class=md-nav__link> Homework </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=running-assembler-programs.html class=md-nav__link> Running assembler programs </a> </li> <li class=md-nav__item> <a href=assembling-bytes.html class=md-nav__link> Assembling bytes </a> </li> <li class=md-nav__item> <a href=handling-instructions.html class=md-nav__link> Handling instructions </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_3_4 type=checkbox id=__nav_3_4 checked> <div class="md-nav__link md-nav__link--index "> <a href=../2022-07/index.html>July 2022</a> <label for=__nav_3_4> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="July 2022" data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> July 2022 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../2022-07/parsing-the-source.html class=md-nav__link> Parsing the source </a> </li> <li class=md-nav__item> <a href=../2022-07/assemble.html class=md-nav__link> Assemble! </a> </li> <li class=md-nav__item> <a href=../2022-07/don-t-byte-me.html class=md-nav__link> Don't byte me! </a> </li> <li class=md-nav__item> <a href=../2022-07/go-ahead-and-jump.html class=md-nav__link> Go ahead and jump! </a> </li> <li class=md-nav__item> <a href=../2022-07/reverse-polish-notation.html class=md-nav__link> Reverse polish notation </a> </li> <li class=md-nav__item> <a href=../2022-07/more-operations.html class=md-nav__link> More operations </a> </li> <li class=md-nav__item> <a href=../2022-07/early-vm-decisions.html class=md-nav__link> Early VM decisions </a> </li> <li class=md-nav__item> <a href=../2022-07/to-the-library.html class=md-nav__link> To the library! </a> </li> <li class=md-nav__item> <a href=../2022-07/becoming-social.html class=md-nav__link> Becoming social </a> </li> <li class=md-nav__item> <a href=../2022-07/turn-fragile-into-rusty.html class=md-nav__link> Turn "fragile" into "rusty" </a> </li> <li class=md-nav__item> <a href=../2022-07/running-our-first-program.html class=md-nav__link> Running our first program </a> </li> <li class=md-nav__item> <a href=../2022-07/a-vm.html class=md-nav__link> A VM </a> </li> <li class=md-nav__item> <a href=../2022-07/it-looks-so-weird.html class=md-nav__link> It looks so weird </a> </li> <li class=md-nav__item> <a href=../2022-07/let-there-be-source-code.html class=md-nav__link> Let there be source code </a> </li> <li class=md-nav__item> <a href=../2022-07/making-virtual-a-reality.html class=md-nav__link> Making virtual a reality </a> </li> <li class=md-nav__item> <a href=../2022-07/what-is-a-virtual-machine-anyway.html class=md-nav__link> What is a Virtual Machine anyway? </a> </li> <li class=md-nav__item> <a href=../2022-07/all-new-once-more.html class=md-nav__link> All new once more </a> </li> <li class=md-nav__item> <a href=../2022-07/state-of-the-journal.html class=md-nav__link> State of the Journal </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_3_5 type=checkbox id=__nav_3_5 checked> <div class="md-nav__link md-nav__link--index "> <a href=../2022-06/index.html>June 2022</a> <label for=__nav_3_5> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="June 2022" data-md-level=2> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> June 2022 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../2022-06/script-or-virtual.html class=md-nav__link> Script or virtual </a> </li> <li class=md-nav__item> <a href=../2022-06/that-use-case.html class=md-nav__link> That use-case I was talking about </a> </li> <li class=md-nav__item> <a href=../2022-06/we-need-another-wheel.html class=md-nav__link> We need another wheel </a> </li> <li class=md-nav__item> <a href=../2022-06/lovem-again.html class=md-nav__link> Lovem again! </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_4 type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4> Journal (complete months) <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Journal (complete months)" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Journal (complete months) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../2024-02/ALL.html class=md-nav__link> February 2024 complete </a> </li> <li class=md-nav__item> <a href=ALL.html class=md-nav__link> August 2022 complete </a> </li> <li class=md-nav__item> <a href=../2022-07/ALL.html class=md-nav__link> July 2022 complete </a> </li> <li class=md-nav__item> <a href=../2022-06/ALL.html class=md-nav__link> June 2022 complete </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#labels class=md-nav__link> Labels </a> </li> <li class=md-nav__item> <a href=#reconstruction class=md-nav__link> Reconstruction </a> </li> <li class=md-nav__item> <a href=#parsing-label-definitions class=md-nav__link> Parsing label definitions </a> </li> <li class=md-nav__item> <a href=#lifetime class=md-nav__link> Lifetime </a> <nav class=md-nav aria-label=Lifetime> <ul class=md-nav__list> <li class=md-nav__item> <a href=#an-example class=md-nav__link> An example </a> </li> <li class=md-nav__item> <a href=#easy-way-out class=md-nav__link> Easy way out </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#run-it-already class=md-nav__link> Run it already! </a> </li> <li class=md-nav__item> <a href=#homework class=md-nav__link> Homework </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=you-labeled-me-ill-label-you>You labeled me, I'll label you<a class=headerlink href=#you-labeled-me-ill-label-you title="Permanent link">&para;</a></h1> <p><strong>We add a feature to our assembler that we overlooked before.</strong></p> <aside class=mdx-author> <p><img alt=@kratenko src=https://avatars.githubusercontent.com/kratenko></p> <p><span><strong>kratenko</strong> 路 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path fill-rule=evenodd d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg></span> <a href=https://github.com/kratenko>kratenko</a></span> <span> <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path fill-rule=evenodd d="M6.75 0a.75.75 0 0 1 .75.75V3h9V.75a.75.75 0 0 1 1.5 0V3h2.75c.966 0 1.75.784 1.75 1.75v16a1.75 1.75 0 0 1-1.75 1.75H3.25a1.75 1.75 0 0 1-1.75-1.75v-16C1.5 3.784 2.284 3 3.25 3H6V.75A.75.75 0 0 1 6.75 0zm-3.5 4.5a.25.25 0 0 0-.25.25V8h18V4.75a.25.25 0 0 0-.25-.25H3.25zM21 9.5H3v11.25c0 .138.112.25.25.25h17.5a.25.25 0 0 0 .25-.25V9.5z"/></svg></span> 2022-08-11 路 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path fill-rule=evenodd d="M0 3.75A.75.75 0 0 1 .75 3h7.497c1.566 0 2.945.8 3.751 2.014A4.496 4.496 0 0 1 15.75 3h7.5a.75.75 0 0 1 .75.75v15.063a.75.75 0 0 1-.755.75l-7.682-.052a3 3 0 0 0-2.142.878l-.89.891a.75.75 0 0 1-1.061 0l-.902-.901a3 3 0 0 0-2.121-.879H.75a.75.75 0 0 1-.75-.75v-15zm11.247 3.747a3 3 0 0 0-3-2.997H1.5V18h6.947a4.5 4.5 0 0 1 2.803.98l-.003-11.483zm1.503 11.485V7.5a3 3 0 0 1 3-3h6.75v13.558l-6.927-.047a4.5 4.5 0 0 0-2.823.971z"/></svg></span> Entry #26 路 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12.5 7.25a.75.75 0 0 0-1.5 0v5.5c0 .27.144.518.378.651l3.5 2a.75.75 0 0 0 .744-1.302L12.5 12.315V7.25z"/><path fill-rule=evenodd d="M12 1C5.925 1 1 5.925 1 12s4.925 11 11 11 11-4.925 11-11S18.075 1 12 1zM2.5 12a9.5 9.5 0 1 1 19 0 9.5 9.5 0 0 1-19 0z"/></svg></span> 10 min read 路 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7.75 6.5a1.25 1.25 0 1 0 0 2.5 1.25 1.25 0 0 0 0-2.5z"/><path fill-rule=evenodd d="M2.5 1A1.5 1.5 0 0 0 1 2.5v8.44c0 .397.158.779.44 1.06l10.25 10.25a1.5 1.5 0 0 0 2.12 0l8.44-8.44a1.5 1.5 0 0 0 0-2.12L12 1.44A1.5 1.5 0 0 0 10.94 1H2.5zm0 1.5h8.44l10.25 10.25-8.44 8.44L2.5 10.94V2.5z"/></svg></span> <a href=https://github.com/kratenko/lovem/releases/tag/v0.0.10-journey>v0.0.10-journey</a> </span></p> </aside> <hr> <p>Over the last few entries we created ourselves a really useful little assembler program. I hope you played around with it and enjoyed not having to write bytecode directly. If you did, you should have noticed that I left out a really important detail. Remember when I was complaining about how bad writing bytecode is? And that it got even worth, when we introduced jumps? Yeah, I did not solve that problem at all. If anything, I made it worse, because you still have to count the relative bytes to your destination, but you do not see those bytes any longer. You just have to know, how many bytes each instruction will produce.</p> <h2 id=labels>Labels<a class=headerlink href=#labels title="Permanent link">&para;</a></h2> <p>There was so much already going on in that assembler program, that I did not want to introduce more complexity up front. Let's fix that now: we will introduce a way to give a position inside your program a name, so that you can <code>goto</code> that name later. And in good tradition, we will call this names <em>labels</em>.</p> <p>The traditional way of defining labels in assembly is by writing them first thing on a line, followed by a colon <code>:</code>. Take a look at this little program, <a href=https://github.com/kratenko/lovem/blob/v0.0.10-journey/pgm/label.lva>label.lva</a>. It is neither good style, nor does it do anything useful, but it shows us labels:</p> <div class=highlight><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>pgm/label.lva</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1> 1</a></span>
<span class=normal><a href=#__codelineno-0-2> 2</a></span>
<span class=normal><a href=#__codelineno-0-3> 3</a></span>
<span class=normal><a href=#__codelineno-0-4> 4</a></span>
<span class=normal><a href=#__codelineno-0-5> 5</a></span>
<span class=normal><a href=#__codelineno-0-6> 6</a></span>
<span class=normal><a href=#__codelineno-0-7> 7</a></span>
<span class=normal><a href=#__codelineno-0-8> 8</a></span>
<span class=normal><a href=#__codelineno-0-9> 9</a></span>
<span class=normal><a href=#__codelineno-0-10>10</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1></a># A small demonstration of how labels work with goto.
<a id=__codelineno-0-2 name=__codelineno-0-2></a>push_u8 1
<a id=__codelineno-0-3 name=__codelineno-0-3></a>goto coda
<a id=__codelineno-0-4 name=__codelineno-0-4></a>
<a id=__codelineno-0-5 name=__codelineno-0-5></a><span class=hll>back:
</span><a id=__codelineno-0-6 name=__codelineno-0-6></a>  push_u8 3
<a id=__codelineno-0-7 name=__codelineno-0-7></a>  fin
<a id=__codelineno-0-8 name=__codelineno-0-8></a>
<a id=__codelineno-0-9 name=__codelineno-0-9></a><span class=hll> coda:  push_u8 2
</span><a id=__codelineno-0-10 name=__codelineno-0-10></a>goto back
</code></pre></div></td></tr></table></div> <p>There are two labels defined here: <code>back</code> in line 5, and <code>coda</code> in line 9. A label definition is a short string that is directly followed by a colon <code>:</code>. We restrict it to letters, numbers, and underscore, with a letter at the front. For the curious, the regex is: <code>^[A-Za-z][0-9A-Za-z_]{0,31}$</code>. As you can see in the example, there can be an optional instruction in the same line as the label definition. Now, how will our assembler parse those?</p> <h2 id=reconstruction>Reconstruction<a class=headerlink href=#reconstruction title="Permanent link">&para;</a></h2> <p>First of all, I did a little reconstruction inside <code>asm.rs</code>, because I did not like how the parsing was done inside an associated function, that also created the <code>AsmPgm</code> instance. That seems messed up. After the change, the <code>fn assemble()</code> creates the instance itself and then calls a method on it, to parse the source code. Here is the new version:</p> <div class=highlight><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>src/asm.rs</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-1-367>367</a></span>
<span class=normal><a href=#__codelineno-1-368>368</a></span>
<span class=normal><a href=#__codelineno-1-369>369</a></span>
<span class=normal><a href=#__codelineno-1-370>370</a></span>
<span class=normal><a href=#__codelineno-1-371>371</a></span>
<span class=normal><a href=#__codelineno-1-372>372</a></span>
<span class=normal><a href=#__codelineno-1-373>373</a></span>
<span class=normal><a href=#__codelineno-1-374>374</a></span>
<span class=normal><a href=#__codelineno-1-375>375</a></span>
<span class=normal><a href=#__codelineno-1-376>376</a></span>
<span class=normal><a href=#__codelineno-1-377>377</a></span>
<span class=normal><a href=#__codelineno-1-378>378</a></span>
<span class=normal><a href=#__codelineno-1-379>379</a></span>
<span class=normal><a href=#__codelineno-1-380>380</a></span>
<span class=normal><a href=#__codelineno-1-381>381</a></span>
<span class=normal><a href=#__codelineno-1-382>382</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-1-367 name=__codelineno-1-367></a><span class=sd>/// Parse assembly source code and turn it into a runnable program (or create report).</span>
<a id=__codelineno-1-368 name=__codelineno-1-368></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>assemble</span><span class=p>(</span><span class=n>name</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>,</span><span class=w> </span><span class=n>content</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=n>Pgm</span><span class=p>,</span><span class=w> </span><span class=n>AsmErrorReport</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-369 name=__codelineno-1-369></a><span class=w>    </span><span class=c1>// create a new, clean instance to fill during parsing:</span>
<a id=__codelineno-1-370 name=__codelineno-1-370></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>asm_pgm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>AsmPgm</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-371 name=__codelineno-1-371></a><span class=w>        </span><span class=n>name</span>: <span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=n>name</span><span class=p>),</span>
<a id=__codelineno-1-372 name=__codelineno-1-372></a><span class=w>        </span><span class=n>instructions</span>: <span class=nc>vec</span><span class=o>!</span><span class=p>[],</span>
<a id=__codelineno-1-373 name=__codelineno-1-373></a><span class=w>        </span><span class=n>line_number</span>: <span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-1-374 name=__codelineno-1-374></a><span class=w>        </span><span class=n>text_pos</span>: <span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-1-375 name=__codelineno-1-375></a><span class=w>        </span><span class=n>error</span>: <span class=nb>None</span><span class=p>,</span>
<a id=__codelineno-1-376 name=__codelineno-1-376></a><span class=w>        </span><span class=n>labels</span>: <span class=nb>Default</span>::<span class=n>default</span><span class=p>(),</span>
<a id=__codelineno-1-377 name=__codelineno-1-377></a><span class=w>    </span><span class=p>};</span>
<a id=__codelineno-1-378 name=__codelineno-1-378></a><span class=w>    </span><span class=c1>// evaluate the source code:</span>
<a id=__codelineno-1-379 name=__codelineno-1-379></a><span class=w>    </span><span class=n>asm_pgm</span><span class=p>.</span><span class=n>process_assembly</span><span class=p>(</span><span class=n>content</span><span class=p>);</span>
<a id=__codelineno-1-380 name=__codelineno-1-380></a><span class=w>    </span><span class=c1>// convert to Pgm instance if successful, or to Error Report, if assembly failed:</span>
<a id=__codelineno-1-381 name=__codelineno-1-381></a><span class=w>    </span><span class=n>asm_pgm</span><span class=p>.</span><span class=n>to_program</span><span class=p>()</span>
<a id=__codelineno-1-382 name=__codelineno-1-382></a><span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>And there is no problem with us changing the code like this. The only public function inside <code>asm.rs</code> is that <code>pub fn assemble()</code>. All methods of <code>AsmPgm</code> are private and therefore internal detail. Not that it would matter at this state of development, but it demonstrates how separation of public API and internal implementation work.</p> <p>What is also new in that function is a new field inside <code>AsmPgm</code>: <code>labels</code>.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=sd>/// A assembler program during parsing/assembling.</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=cp>#[derive(Debug)]</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=k>struct</span> <span class=nc>AsmPgm</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=w>    </span><span class=o>..</span><span class=p>.</span>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=w>    </span><span class=sd>/// A map storing label definitions by name with there position in bytecode.</span>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=hll><span class=w>    </span><span class=n>labels</span>: <span class=nc>HashMap</span><span class=o>&lt;</span><span class=nb>String</span><span class=p>,</span><span class=w> </span><span class=kt>usize</span><span class=o>&gt;</span><span class=p>,</span>
</span><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=p>}</span>
</code></pre></div> <p>It is a HashMap (aka. associative array in other languages). This is where we put all label definitions we find, while parsing the source file. It maps the label's name to its position inside the bytecode. Here we can look up where to jump, for a goto that wants to jump to a label.</p> <p>This is what our parsing methods now look like:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-3-327>327</a></span>
<span class=normal><a href=#__codelineno-3-328>328</a></span>
<span class=normal><a href=#__codelineno-3-329>329</a></span>
<span class=normal><a href=#__codelineno-3-330>330</a></span>
<span class=normal><a href=#__codelineno-3-331>331</a></span>
<span class=normal><a href=#__codelineno-3-332>332</a></span>
<span class=normal><a href=#__codelineno-3-333>333</a></span>
<span class=normal><a href=#__codelineno-3-334>334</a></span>
<span class=normal><a href=#__codelineno-3-335>335</a></span>
<span class=normal><a href=#__codelineno-3-336>336</a></span>
<span class=normal><a href=#__codelineno-3-337>337</a></span>
<span class=normal><a href=#__codelineno-3-338>338</a></span>
<span class=normal><a href=#__codelineno-3-339>339</a></span>
<span class=normal><a href=#__codelineno-3-340>340</a></span>
<span class=normal><a href=#__codelineno-3-341>341</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-3-327 name=__codelineno-3-327></a><span class=k>fn</span> <span class=nf>process</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>content</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=p>(),</span><span class=w> </span><span class=n>AsmError</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-3-328 name=__codelineno-3-328></a><span class=w>    </span><span class=c1>// Go over complete source, extracting instructions. Some will have their opargs</span>
<a id=__codelineno-3-329 name=__codelineno-3-329></a><span class=w>    </span><span class=c1>// left empty (with placeholders).</span>
<a id=__codelineno-3-330 name=__codelineno-3-330></a><span class=hll><span class=w>    </span><span class=bp>self</span><span class=p>.</span><span class=n>parse</span><span class=p>(</span><span class=n>content</span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
</span><a id=__codelineno-3-331 name=__codelineno-3-331></a><span class=hll><span class=w>    </span><span class=bp>self</span><span class=p>.</span><span class=n>update_instructions</span><span class=p>()</span>
</span><a id=__codelineno-3-332 name=__codelineno-3-332></a><span class=p>}</span>
<a id=__codelineno-3-333 name=__codelineno-3-333></a>
<a id=__codelineno-3-334 name=__codelineno-3-334></a><span class=sd>/// Process assembly source code. Must be used with &quot;empty&quot; AsmPgm.</span>
<a id=__codelineno-3-335 name=__codelineno-3-335></a><span class=k>fn</span> <span class=nf>process_assembly</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>content</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-3-336 name=__codelineno-3-336></a><span class=w>    </span><span class=c1>// this function is just a wrapper around `process()`, so that I can use the</span>
<a id=__codelineno-3-337 name=__codelineno-3-337></a><span class=w>    </span><span class=c1>// return magic and don&#39;t need to write the error check twice.</span>
<a id=__codelineno-3-338 name=__codelineno-3-338></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=kd>let</span><span class=w> </span><span class=nb>Err</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>process</span><span class=p>(</span><span class=n>content</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-3-339 name=__codelineno-3-339></a><span class=w>        </span><span class=bp>self</span><span class=p>.</span><span class=n>error</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
<a id=__codelineno-3-340 name=__codelineno-3-340></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-3-341 name=__codelineno-3-341></a><span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>The important part is, that we have to steps now. We parse the complete source, as before. The second run is needed to write the actual relative jump address to the instructions. We do not know them during parsing, at least not for jumps forward.</p> <h2 id=parsing-label-definitions>Parsing label definitions<a class=headerlink href=#parsing-label-definitions title="Permanent link">&para;</a></h2> <p>I got a little fancy again, while writing the function for parsing label definitions:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-4-257>257</a></span>
<span class=normal><a href=#__codelineno-4-258>258</a></span>
<span class=normal><a href=#__codelineno-4-259>259</a></span>
<span class=normal><a href=#__codelineno-4-260>260</a></span>
<span class=normal><a href=#__codelineno-4-261>261</a></span>
<span class=normal><a href=#__codelineno-4-262>262</a></span>
<span class=normal><a href=#__codelineno-4-263>263</a></span>
<span class=normal><a href=#__codelineno-4-264>264</a></span>
<span class=normal><a href=#__codelineno-4-265>265</a></span>
<span class=normal><a href=#__codelineno-4-266>266</a></span>
<span class=normal><a href=#__codelineno-4-267>267</a></span>
<span class=normal><a href=#__codelineno-4-268>268</a></span>
<span class=normal><a href=#__codelineno-4-269>269</a></span>
<span class=normal><a href=#__codelineno-4-270>270</a></span>
<span class=normal><a href=#__codelineno-4-271>271</a></span>
<span class=normal><a href=#__codelineno-4-272>272</a></span>
<span class=normal><a href=#__codelineno-4-273>273</a></span>
<span class=normal><a href=#__codelineno-4-274>274</a></span>
<span class=normal><a href=#__codelineno-4-275>275</a></span>
<span class=normal><a href=#__codelineno-4-276>276</a></span>
<span class=normal><a href=#__codelineno-4-277>277</a></span>
<span class=normal><a href=#__codelineno-4-278>278</a></span>
<span class=normal><a href=#__codelineno-4-279>279</a></span>
<span class=normal><a href=#__codelineno-4-280>280</a></span>
<span class=normal><a href=#__codelineno-4-281>281</a></span>
<span class=normal><a href=#__codelineno-4-282>282</a></span>
<span class=normal><a href=#__codelineno-4-283>283</a></span>
<span class=normal><a href=#__codelineno-4-284>284</a></span>
<span class=normal><a href=#__codelineno-4-285>285</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-4-257 name=__codelineno-4-257></a><span class=sd>/// Parses and extracts optional label definition from line.</span>
<a id=__codelineno-4-258 name=__codelineno-4-258></a><span class=sd>///</span>
<a id=__codelineno-4-259 name=__codelineno-4-259></a><span class=sd>/// Looks for a colon &#39;:&#39;. If one exists, the part before the first colon will be</span>
<a id=__codelineno-4-260 name=__codelineno-4-260></a><span class=sd>/// seen as the name for a label, that is defined on this line. Instructions inside</span>
<a id=__codelineno-4-261 name=__codelineno-4-261></a><span class=sd>/// the program that execute jumps can refer to these labels as a destination.</span>
<a id=__codelineno-4-262 name=__codelineno-4-262></a><span class=sd>/// Lines containing a label definition may also contain an instruction and/or a comment.</span>
<a id=__codelineno-4-263 name=__codelineno-4-263></a><span class=sd>/// This can return `AsmError::InvalidLabel` if the part before the colon is not a valid</span>
<a id=__codelineno-4-264 name=__codelineno-4-264></a><span class=sd>/// label name, or `AsmError::DuplicateLabel` if a label name is reused.</span>
<a id=__codelineno-4-265 name=__codelineno-4-265></a><span class=sd>/// If a label could be parsed, it will be stored to the `AsmPgm`.</span>
<a id=__codelineno-4-266 name=__codelineno-4-266></a><span class=sd>/// On success, the line without the label definition is returned, so that it can be</span>
<a id=__codelineno-4-267 name=__codelineno-4-267></a><span class=sd>/// used to extract an instruction. This will be the complete line, if there was no</span>
<a id=__codelineno-4-268 name=__codelineno-4-268></a><span class=sd>/// label definition.</span>
<a id=__codelineno-4-269 name=__codelineno-4-269></a><span class=hll><span class=k>fn</span> <span class=nf>parse_label_definition</span><span class=o>&lt;&#39;</span><span class=na>a</span><span class=o>&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>line</span>: <span class=kp>&amp;</span><span class=o>&#39;</span><span class=na>a</span> <span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;&amp;&#39;</span><span class=na>a</span><span class=w> </span><span class=kt>str</span><span class=p>,</span><span class=w> </span><span class=n>AsmError</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><a id=__codelineno-4-270 name=__codelineno-4-270></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=kd>let</span><span class=w> </span><span class=nb>Some</span><span class=p>((</span><span class=n>label</span><span class=p>,</span><span class=w> </span><span class=n>rest</span><span class=p>))</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>line</span><span class=p>.</span><span class=n>split_once</span><span class=p>(</span><span class=s>&quot;:&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-271 name=__codelineno-4-271></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>label</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>label</span><span class=p>.</span><span class=n>trim_start</span><span class=p>();</span>
<a id=__codelineno-4-272 name=__codelineno-4-272></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=n>VALID_LABEL</span><span class=p>.</span><span class=n>is_match</span><span class=p>(</span><span class=n>label</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-273 name=__codelineno-4-273></a><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>labels</span><span class=p>.</span><span class=n>contains_key</span><span class=p>(</span><span class=n>label</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-274 name=__codelineno-4-274></a><span class=w>                </span><span class=nb>Err</span><span class=p>(</span><span class=n>AsmError</span>::<span class=n>DuplicateLabel</span><span class=p>(</span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=n>label</span><span class=p>)))</span>
<a id=__codelineno-4-275 name=__codelineno-4-275></a><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-276 name=__codelineno-4-276></a><span class=w>                </span><span class=bp>self</span><span class=p>.</span><span class=n>labels</span><span class=p>.</span><span class=n>insert</span><span class=p>(</span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=n>label</span><span class=p>),</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>text_pos</span><span class=p>);</span>
<a id=__codelineno-4-277 name=__codelineno-4-277></a><span class=w>                </span><span class=nb>Ok</span><span class=p>(</span><span class=n>rest</span><span class=p>)</span>
<a id=__codelineno-4-278 name=__codelineno-4-278></a><span class=w>            </span><span class=p>}</span>
<a id=__codelineno-4-279 name=__codelineno-4-279></a><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-280 name=__codelineno-4-280></a><span class=w>            </span><span class=nb>Err</span><span class=p>(</span><span class=n>AsmError</span>::<span class=n>InvalidLabel</span><span class=p>(</span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=n>label</span><span class=p>)))</span>
<a id=__codelineno-4-281 name=__codelineno-4-281></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-4-282 name=__codelineno-4-282></a><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-283 name=__codelineno-4-283></a><span class=w>        </span><span class=nb>Ok</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
<a id=__codelineno-4-284 name=__codelineno-4-284></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-4-285 name=__codelineno-4-285></a><span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>The method is trying to find a label definition in the line, and if so, handles it. We use our trusted <code>Result&lt;&gt;</code> returning, to communicate potential errors. But instead of <code>Ok(())</code>, which is the empty okay value, we return a <code>&amp;str</code> on success. This is because there might also be an instruction in the line. If we find a label definition, it returns the line after the colon. If there is none, it returns the complete line it got. This gives us the lines as we used to get before we introduced labels. Great. But what is that weird <code>'a</code> that shows up in that highlighted line everywhere?</p> <h2 id=lifetime>Lifetime<a class=headerlink href=#lifetime title="Permanent link">&para;</a></h2> <p>Yeah, this is where it becomes rusty, again. I said, in an early post, that you would hate the Rust compiler and its pedantic error messages. The thing Rust is most pedantic about, is ownership and access to values you do not own. We are working with references to <code>String</code>s here. A <code>&amp;str</code> references the bytes inside that <code>String</code> directly (a <code>&amp;str</code> need not reference a <code>String</code>, but it does here). We did that before, where is the problem now? This is the first time we are returning a <code>&amp;str</code>.</p> <p>When you are using references, Rust makes sure that the value you are referencing exists at least as long as the reference exists. That is easy for functions, as long as you drop every reference you have when you are done. But in this function, we return a reference to the parameter we got. Rust cannot allow that without some special care. When I remove the <code>'a</code> parts of the method, I get a compilation error:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>error[E0623]: lifetime mismatch
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>   --&gt; src/asm.rs:277:21
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>    |
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>269 |     fn parse_label_definition(&amp;mut self, line: &amp;str) -&gt; Result&lt;&amp;str, AsmError&gt; {
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>    |                                                ----     ----------------------
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>    |                                                |
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>    |                                                this parameter and the return type are declared with different lifetimes...
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>...
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a>277 |                     Ok(rest)
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>    |                     ^^^^^^^^ ...but data from `line` is returned here
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>    |
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a>    = note: each elided lifetime in input position becomes a distinct lifetime
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a>help: consider introducing a named lifetime parameter and update trait if needed
<a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a>    |
<a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a>269 |     fn parse_label_definition&lt;&#39;a&gt;(&amp;&#39;a mut self, line: &amp;&#39;a str) -&gt; Result&lt;&amp;str, AsmError&gt; {
<a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a>    |                              ++++  ++                  ++
</code></pre></div> <p>The compiler tells me, that I messed up the lifetimes. It even proposes a change that introduces lifetime parameters (but gets it slightly wrong). What do we do with the <code>'a</code>?</p> <p>Well we introduce a lifetime parameter called <code>a</code>. The syntax for that is the apostrophe, which looked weird to me at start, but it is so lightweight, that I came to like it. It is custom, to just call your lifetimes <code>'a</code>, <code>'b</code>, ... &ndash; they normally don't have a long scope anyway. The thing we are telling the compiler with this parameter is this: the lifetime of the returned <code>&amp;str</code> is dependent on the lifetime of the parameter <code>line: &amp;str</code>. So whenever the reference the function is called with runs out of scope, the reference that was returned must be out of scope as well.</p> <h3 id=an-example>An example<a class=headerlink href=#an-example title="Permanent link">&para;</a></h3> <p>This is a concept that is new to many programmers when they learn Rust. I think, what we do here demonstrates it quiet well. Let us look at what happens for line 9 of our assembly program:</p> <div class=highlight><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>pgm/label.lva</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-6-9>9</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-6-9 name=__codelineno-6-9></a> coda:  push_u8 2
</code></pre></div></td></tr></table></div> <p>Our function receives a reference to a <code>String</code> holding that line: <code>" coda: push_u8 2"</code>. It finds the label <code>coda</code> and stores it inside <code>self.labels</code>. Its work is done, but there might be more to this line. It returns a reference to a substring of it (<code>&amp;str</code> are actually slices; they can reference only a part of a <code>String</code>'s data). That is what we return, a reference to the part data inside the <code>String</code>, starting at the first char after the colon, so it looks like this <code>" push_u8 2"</code>. It is <em>not</em> a copy, it is the same area inside the computer's memory! So if you want to make certain, that there are no accesses to memory after its content has run out of scope (use after free, or use of local variable after it runs our of scope), you <em>must not</em> allow access to it, unless you are sure the value still exists. And this is what Rust does. This is what makes Rust a secure language. <em>Many</em> bugs and exploits in the world exist, because most languages do not check this, but leave the responsibility to the programmer. And the really cool thing about Rust is, it does this completely at compile time, as you can see by the fact that we got a compiler error.</p> <p>The way we call our function is not a problem at all:</p> <div class=highlight><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>src/asm.rs</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-7-292>292</a></span>
<span class=normal><a href=#__codelineno-7-293>293</a></span>
<span class=normal><a href=#__codelineno-7-294>294</a></span>
<span class=normal><a href=#__codelineno-7-295>295</a></span>
<span class=normal><a href=#__codelineno-7-296>296</a></span>
<span class=normal><a href=#__codelineno-7-297>297</a></span>
<span class=normal><a href=#__codelineno-7-298>298</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-7-292 name=__codelineno-7-292></a><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=n>line</span><span class=p>)</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>content</span><span class=p>.</span><span class=n>lines</span><span class=p>().</span><span class=n>enumerate</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-7-293 name=__codelineno-7-293></a><span class=w>    </span><span class=c1>// File lines start counting at 1:</span>
<a id=__codelineno-7-294 name=__codelineno-7-294></a><span class=w>    </span><span class=bp>self</span><span class=p>.</span><span class=n>line_number</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<a id=__codelineno-7-295 name=__codelineno-7-295></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>line</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>parse_label_definition</span><span class=p>(</span><span class=n>line</span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
<a id=__codelineno-7-296 name=__codelineno-7-296></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>line</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>AsmPgm</span>::<span class=n>clean_line</span><span class=p>(</span><span class=n>line</span><span class=p>);</span>
<a id=__codelineno-7-297 name=__codelineno-7-297></a><span class=w>    </span><span class=bp>self</span><span class=p>.</span><span class=n>parse_clean_line</span><span class=p>(</span><span class=n>line</span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
<a id=__codelineno-7-298 name=__codelineno-7-298></a><span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>Our initial <code>line</code> comes from line 228. It is already a reference, because <code>content.lines()</code> is also giving us a reference to the memory inside of <code>content</code>. That is a reference already, the <code>String</code> variable that holds (and owns) the data lives inside <code>lovas.rs</code>:</p> <div class=highlight><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>src/bin/lovas.rs</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-8-67>67</a></span>
<span class=normal><a href=#__codelineno-8-68>68</a></span>
<span class=normal><a href=#__codelineno-8-69>69</a></span>
<span class=normal><a href=#__codelineno-8-70>70</a></span>
<span class=normal><a href=#__codelineno-8-71>71</a></span>
<span class=normal><a href=#__codelineno-8-72>72</a></span>
<span class=normal><a href=#__codelineno-8-73>73</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-8-67 name=__codelineno-8-67></a><span class=w>    </span><span class=c1>// read complete source file into String:</span>
<a id=__codelineno-8-68 name=__codelineno-8-68></a><span class=hll><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>content</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span>::<span class=n>fs</span>::<span class=n>read_to_string</span><span class=p>(</span><span class=o>&amp;</span><span class=n>args</span><span class=p>.</span><span class=n>source</span><span class=p>)</span>
</span><a id=__codelineno-8-69 name=__codelineno-8-69></a><span class=w>        </span><span class=p>.</span><span class=n>with_context</span><span class=p>(</span>
<a id=__codelineno-8-70 name=__codelineno-8-70></a><span class=w>            </span><span class=o>||</span><span class=w> </span><span class=fm>format!</span><span class=p>(</span><span class=s>&quot;could not read file `{}`&quot;</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>name</span><span class=p>)</span>
<a id=__codelineno-8-71 name=__codelineno-8-71></a><span class=w>        </span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
<a id=__codelineno-8-72 name=__codelineno-8-72></a><span class=w>    </span><span class=c1>// run the assembler:</span>
<a id=__codelineno-8-73 name=__codelineno-8-73></a><span class=hll><span class=w>    </span><span class=k>match</span><span class=w> </span><span class=n>asm</span>::<span class=n>assemble</span><span class=p>(</span><span class=o>&amp;</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>content</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span></code></pre></div></td></tr></table></div> <p>We do not copy any of that bytes along the way. The first time we do that is in <code>clean_line()</code>. Returning a <code>&amp;str</code> will not work there, because we actually modify the contents of the string, by replacing characters inside it. Have you ever tried to work with inplace "substrings" (I mean char arrays, like this <code>char *str</code>), without modifying the contents (placing <code>\0</code> bytes). It is not fun. In Rust, it can be, if you understand lifetime restrictions.</p> <h3 id=easy-way-out>Easy way out<a class=headerlink href=#easy-way-out title="Permanent link">&para;</a></h3> <p>If you run into problems with your <code>&amp;str</code> inside a Rust program, there is often an easy way to get around that. You can simply create a new <code>String</code> from your <code>&amp;str</code>, as we do in <code>clean_line()</code>. That will copy the bytes. For our program, that would have been no problem at all. Cloning a few bytes of source code for every line during assembly would cost us next to nothing. You would not notice in execution time. But things are different when you need to quickly handle long substrings in a program. Think of a diagnostic job on a busy server. And remember that <code>String</code>s will be created on the heap. That is a complexity that you sometimes want to avoid. When programming microcontrollers, there is a chance that you do not even have a memory allocator at your disposal. And microcontrollers is, what we are aiming for in our project. There are already some parts of lovem, that we will need to change, because of that. But that is a story for another time. I just thought that this was a nice little example to introduce you to lifetime parameters. We will need them at some point...</p> <h2 id=run-it-already>Run it already!<a class=headerlink href=#run-it-already title="Permanent link">&para;</a></h2> <p>This is a long entry already. You can look at the complete state of the assembler directly in the sourcecode. You should know how to find the tags inside the repo by now. But I want to execute our new program, using the labels, before I end this. Here it is again:</p> <div class=highlight><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>pgm/label.lva</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-9-1> 1</a></span>
<span class=normal><a href=#__codelineno-9-2> 2</a></span>
<span class=normal><a href=#__codelineno-9-3> 3</a></span>
<span class=normal><a href=#__codelineno-9-4> 4</a></span>
<span class=normal><a href=#__codelineno-9-5> 5</a></span>
<span class=normal><a href=#__codelineno-9-6> 6</a></span>
<span class=normal><a href=#__codelineno-9-7> 7</a></span>
<span class=normal><a href=#__codelineno-9-8> 8</a></span>
<span class=normal><a href=#__codelineno-9-9> 9</a></span>
<span class=normal><a href=#__codelineno-9-10>10</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1></a># A small demonstration of how labels work with goto.
<a id=__codelineno-9-2 name=__codelineno-9-2></a>push_u8 1
<a id=__codelineno-9-3 name=__codelineno-9-3></a>goto coda
<a id=__codelineno-9-4 name=__codelineno-9-4></a>
<a id=__codelineno-9-5 name=__codelineno-9-5></a>back:
<a id=__codelineno-9-6 name=__codelineno-9-6></a>  push_u8 3
<a id=__codelineno-9-7 name=__codelineno-9-7></a>  fin
<a id=__codelineno-9-8 name=__codelineno-9-8></a>
<a id=__codelineno-9-9 name=__codelineno-9-9></a> coda:  push_u8 2
<a id=__codelineno-9-10 name=__codelineno-9-10></a>goto back
</code></pre></div></td></tr></table></div> <p>We need to execute it with the <code>--trace</code> flag, or we will not see anything:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>kratenko@jotun:~/git/lovem$ cargo run --bin lovas -- -r pgm/label.lva --print --trace
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>   Compiling lovem v0.0.10 (/home/kratenko/git/lovem)
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>    Finished dev [unoptimized + debuginfo] target(s) in 1.33s
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>     Running `target/debug/lovas -r pgm/label.lva --print --trace`
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>Pgm { name: &quot;pgm/label.lva&quot;, text: [2, 1, 32, 0, 3, 2, 3, 255, 2, 2, 32, 255, 248] }
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>VM { stack: [], pc: 0, op_cnt: 0, trace: true, watermark: 0 }
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>Executing op 0x02
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>VM { stack: [1], pc: 2, op_cnt: 1, trace: true, watermark: 1 }
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>Executing op 0x20
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>  Jump from 5 by 3
<a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a>VM { stack: [1], pc: 8, op_cnt: 2, trace: true, watermark: 1 }
<a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a>Executing op 0x02
<a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>VM { stack: [1, 2], pc: 10, op_cnt: 3, trace: true, watermark: 2 }
<a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a>Executing op 0x20
<a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>  Jump from 13 by -8
<a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a>VM { stack: [1, 2], pc: 5, op_cnt: 4, trace: true, watermark: 2 }
<a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a>Executing op 0x02
<a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a>VM { stack: [1, 2, 3], pc: 7, op_cnt: 5, trace: true, watermark: 3 }
<a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a>Terminated!
<a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a>VM { stack: [1, 2, 3], pc: 8, op_cnt: 6, trace: true, watermark: 3 }
<a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a>Terminated.
<a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a>Runtime=65.598碌s
<a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a>op_cnt=6, pc=8, stack-depth=3, watermark=3
</code></pre></div> <p>The program has three <code>push_u8</code> operations. If you executed them in the order of the source code, they would push <code>[1, 3, 2]</code> to the stack. But because of the <code>goto</code> instructions, they are not executed in that order. You can see the jumps in the trace, and you can see that the stack at termination holds the values in this order: <code>[1, 2, 3]</code>.</p> <p>Not much of a program, but it shows you, how our new labels work. And finally: no more counting bytes!</p> <h2 id=homework>Homework<a class=headerlink href=#homework title="Permanent link">&para;</a></h2> <p>Our programs <code>endless.lva</code> and <code>endless-stack.lva</code> no longer work, because we changed how the <code>goto</code> instruction must be written. Can you fix them?</p> <hr> <p><em>The source code for this post can be found under the tag <code>v0.0.10-journey</code></em>.</p> <ul> <li><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path fill-rule=evenodd d="M8.78 4.97a.75.75 0 0 1 0 1.06L2.81 12l5.97 5.97a.75.75 0 1 1-1.06 1.06l-6.5-6.5a.75.75 0 0 1 0-1.06l6.5-6.5a.75.75 0 0 1 1.06 0zm6.44 0a.75.75 0 0 0 0 1.06L21.19 12l-5.97 5.97a.75.75 0 1 0 1.06 1.06l6.5-6.5a.75.75 0 0 0 0-1.06l-6.5-6.5a.75.75 0 0 0-1.06 0z"/></svg></span> <a href=https://github.com/kratenko/lovem/tree/v0.0.10-journey>v0.0.10-journey source code</a></li> <li><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7.75 6.5a1.25 1.25 0 1 0 0 2.5 1.25 1.25 0 0 0 0-2.5z"/><path fill-rule=evenodd d="M2.5 1A1.5 1.5 0 0 0 1 2.5v8.44c0 .397.158.779.44 1.06l10.25 10.25a1.5 1.5 0 0 0 2.12 0l8.44-8.44a1.5 1.5 0 0 0 0-2.12L12 1.44A1.5 1.5 0 0 0 10.94 1H2.5zm0 1.5h8.44l10.25 10.25-8.44 8.44L2.5 10.94V2.5z"/></svg></span> <a href=https://github.com/kratenko/lovem/releases/tag/v0.0.10-journey>v0.0.10-journey release</a></li> <li><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 2.5a.5.5 0 0 0-.5.5v18a.5.5 0 0 0 .5.5h1.75a.75.75 0 0 1 0 1.5H5a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h9.982a2 2 0 0 1 1.414.586l4.018 4.018A2 2 0 0 1 21 7.018V21a2 2 0 0 1-2 2h-2.75a.75.75 0 0 1 0-1.5H19a.5.5 0 0 0 .5-.5V7.018a.5.5 0 0 0-.146-.354l-4.018-4.018a.5.5 0 0 0-.354-.146H5z"/><path d="M11.5 15.75a.75.75 0 0 1 .75-.75h1a.75.75 0 0 1 0 1.5h-1a.75.75 0 0 1-.75-.75zm.75-3.75a.75.75 0 0 0 0 1.5h1a.75.75 0 0 0 0-1.5h-1zm-.75-2.25a.75.75 0 0 1 .75-.75h1a.75.75 0 0 1 0 1.5h-1a.75.75 0 0 1-.75-.75zM12.25 6a.75.75 0 0 0 0 1.5h1a.75.75 0 0 0 0-1.5h-1zm-.75-2.25a.75.75 0 0 1 .75-.75h1a.75.75 0 0 1 0 1.5h-1a.75.75 0 0 1-.75-.75zM9.75 13.5a.75.75 0 0 0 0 1.5h1a.75.75 0 0 0 0-1.5h-1zM9 11.25a.75.75 0 0 1 .75-.75h1a.75.75 0 0 1 0 1.5h-1a.75.75 0 0 1-.75-.75zm.75-3.75a.75.75 0 0 0 0 1.5h1a.75.75 0 0 0 0-1.5h-1zM9 5.25a.75.75 0 0 1 .75-.75h1a.75.75 0 0 1 0 1.5h-1A.75.75 0 0 1 9 5.25z"/><path fill-rule=evenodd d="M11 17a2 2 0 0 0-2 2v4.25c0 .414.336.75.75.75h3.5a.75.75 0 0 0 .75-.75V19a2 2 0 0 0-2-2h-1zm-.5 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v3.5h-2V19z"/></svg></span> <a href=https://github.com/kratenko/lovem/archive/refs/tags/v0.0.10-journey.zip>v0.0.10-journey.zip</a></li> <li><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 2.5a.5.5 0 0 0-.5.5v18a.5.5 0 0 0 .5.5h1.75a.75.75 0 0 1 0 1.5H5a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h9.982a2 2 0 0 1 1.414.586l4.018 4.018A2 2 0 0 1 21 7.018V21a2 2 0 0 1-2 2h-2.75a.75.75 0 0 1 0-1.5H19a.5.5 0 0 0 .5-.5V7.018a.5.5 0 0 0-.146-.354l-4.018-4.018a.5.5 0 0 0-.354-.146H5z"/><path d="M11.5 15.75a.75.75 0 0 1 .75-.75h1a.75.75 0 0 1 0 1.5h-1a.75.75 0 0 1-.75-.75zm.75-3.75a.75.75 0 0 0 0 1.5h1a.75.75 0 0 0 0-1.5h-1zm-.75-2.25a.75.75 0 0 1 .75-.75h1a.75.75 0 0 1 0 1.5h-1a.75.75 0 0 1-.75-.75zM12.25 6a.75.75 0 0 0 0 1.5h1a.75.75 0 0 0 0-1.5h-1zm-.75-2.25a.75.75 0 0 1 .75-.75h1a.75.75 0 0 1 0 1.5h-1a.75.75 0 0 1-.75-.75zM9.75 13.5a.75.75 0 0 0 0 1.5h1a.75.75 0 0 0 0-1.5h-1zM9 11.25a.75.75 0 0 1 .75-.75h1a.75.75 0 0 1 0 1.5h-1a.75.75 0 0 1-.75-.75zm.75-3.75a.75.75 0 0 0 0 1.5h1a.75.75 0 0 0 0-1.5h-1zM9 5.25a.75.75 0 0 1 .75-.75h1a.75.75 0 0 1 0 1.5h-1A.75.75 0 0 1 9 5.25z"/><path fill-rule=evenodd d="M11 17a2 2 0 0 0-2 2v4.25c0 .414.336.75.75.75h3.5a.75.75 0 0 0 .75-.75V19a2 2 0 0 0-2-2h-1zm-.5 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v3.5h-2V19z"/></svg></span> <a href=https://github.com/kratenko/lovem/archive/refs/tags/v0.0.10-journey.tar.gz>v0.0.10-journey.tar.gz</a></li> <li><code>git checkout v0.0.10-journey</code></li> </ul> <p><em><a href=../source-code.html#tags>What does this mean?</a></em></p> <script src=https://giscus.app/client.js data-repo=kratenko/lovem data-repo-id=R_kgDOHjmZ5Q data-category=Comments data-category-id=DIC_kwDOHjmZ5c4CQPDu data-mapping=pathname data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=light data-lang=en data-loading=lazy crossorigin=anonymous async>
</script> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=what-if.html class="md-footer__link md-footer__link--prev" aria-label="Previous:  What if?" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> What if? </div> </div> </a> <a href=running-assembler-programs.html class="md-footer__link md-footer__link--next" aria-label="Next:  Running assembler programs" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Running assembler programs </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/kratenko target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://chaos.social/@kratenko target=_blank rel=noopener title=chaos.social class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.indexes", "navigation.sections", "navigation.top", "navigation.tracking", "navigation.expand"], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../assets/javascripts/bundle.5a2dcb6a.min.js></script> </body> </html>